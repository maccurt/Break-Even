<div class="container">
    <div class="row">

        <div class="col-12 col-md-9 col-lg-7 col-xl-5 col-xxl-4 mb-5">

            <mat-card>
                <mat-card-title>Unit Profit Analysis</mat-card-title>
                <mat-card-content data-test-id="unit-analysis-calculator">
                    <div class="form-wrapper">
                        <form class="calculator-form" [formGroup]="formGroup" (submit)="submit()">

                            <div class="mb-3" [ngClass]="{'has-error':(isInvalid(revenuePerUnitControl))}">

                                <label for="revenuePerUnit" class="form-label">Revenue Per Unit</label>
                                <input id="revenuePerUnit" class="form-control" type="number"
                                    data-test-id="revenue-per-unit" formControlName="revenuePerUnit">
                                <div class="hint">
                                    required
                                </div>
                            </div>

                            <div class="mb-3"
                                [ngClass]="{'has-error':(isVariableExpenseValid(formGroup.get('variableExpense')!))}">
                                <label for="variableExpense" class="form-label">Variable Expense</label>
                                <input id="variableExpense" class="form-control" type="number"
                                    data-test-id="variable-expense" formControlName="variableExpense">

                                <div class="hint">
                                    required: must be less than revenue per unit
                                </div>

                            </div>

                            <div class="mb-3" [ngClass]="{'has-error':(isInvalid(formGroup.get('fixedExpense')!))}">
                                <label for="fixedExpense">Fixed Expense</label>
                                <input id="fixedExpense" class="form-control" type="number" data-test-id="fixed-expense"
                                    formControlName="fixedExpense">
                                <div class="hint">
                                    required
                                </div>
                            </div>

                            <div class="mb-3" [ngClass]="{'has-error':(isInvalid(formGroup.get('netIncome')!))}">
                                <label for="netIncome">Net Income</label>
                                <input id="netIncome" class="form-control" type="number" data-test-id="net-income"
                                    formControlName="netIncome">
                                <div class="hint">
                                    required
                                </div>
                            </div>

                            <div class="mb-3" [ngClass]="{'has-error':(isInvalid(formGroup.get('taxRate')!))}">
                                <label for="taxRate">Tax Rate %</label>
                                <input id="taxRate" class="form-control" type="number" data-test-id="tax-rate"
                                    formControlName="taxRate">
                                <div class="hint">
                                    required: 1 to 99
                                </div>
                            </div>

                            <button id="calculate-break-even" data-test-id="calculate-break-even" type="submit"
                                class="btn btn-primary">Calculate</button>
                        </form>
                    </div>

                </mat-card-content>
            </mat-card>

        </div>

        <div *ngIf="incomeStatement" class="col-12 col-md-9 col-lg-7 col-xl-5 col-xxl-4 ">

            <mat-card style="margin-bottom:15px;">
                <mat-card-content>
                    <div data-test-id="unit-profit-analysis-unit">
                        <h3>
                            <div *ngIf="incomeStatement.netIncomeDesired> 0">
                                {{incomeStatement.units | number}} Units To Make A Net Income Of
                                ${{incomeStatement.netIncomeDesired |number:'1.2-2' }}.

                            </div>

                            <div *ngIf="incomeStatement.netIncomeDesired === 0">
                                {{incomeStatement.units | number}} Units To Break Even.
                            </div>

                        </h3>
                    </div>
                </mat-card-content>
            </mat-card>

            <mat-card>
                <mat-card-title>Income Statement</mat-card-title>
                <mat-card-content>
                    <table data-test-id="unit-income-statement" class="table table-striped">

                        <tbody>
                            <tr class="total border-2">
                                <td>Revenue</td>
                                <td> <span data-test-id="revenue"> ${{incomeStatement.revenue
                                        |number:'1.2-2'}}</span>
                                </td>

                            </tr>
                            <tr class="sub-total">
                                <td class="indent">+ Variable Expense</td>
                                <td><span data-test-id="variable-expense"> {{incomeStatement.variableExpense
                                        |number:'1.2-2'}}</span></td>

                            </tr>

                            <tr class="sub-total border-2">
                                <td class="indent">+ Fixed Expense</td>
                                <td><span data-test-id="fixed-expense"> {{incomeStatement.fixedExpense
                                        |number:'1.2-2'}}</span></td>

                            </tr>

                            <tr class="total border-2">
                                <td>Expense</td>
                                <td><span data-test-id="expense-total"> ${{incomeStatement.expenseTotal
                                        |number:'1.2-2'}}</span></td>

                            </tr>

                            <tr class="total border-2 ">
                                <td>Gross Profit</td>
                                <td><span data-test-id="gross-profit">
                                        ${{incomeStatement.grossProfit|number:'1.2-2'}}</span></td>
                            </tr>


                            <tr class="sub-total border-2">
                                <td class="indent">
                                    - Income Tax <span class="tax-rate-percent" data-test-id="tax-rate-percent">
                                        {{incomeStatement.taxRatePercent}}%</span> </td>
                                <td><span data-test-id="income-tax">
                                        {{incomeStatement.incomeTax|number:'1.2-2'}}</span></td>
                            </tr>

                            <tr class="total ">
                                <td>Net Income</td>
                                <td><span data-test-id="net-income">
                                        ${{incomeStatement.netIncome|number:'1.2-2'}}</span></td>
                            </tr>
                        </tbody>

                    </table>
                </mat-card-content>

            </mat-card>
        </div>

        <div *ngIf="incomeStatement" class="col-12 col-md-9 col-lg-7 col-xl-5 col-xxl-4">

            <mat-card>
                <mat-card-content style="border:1px solid red ;" >
                    <highcharts-chart [Highcharts]="Highcharts" [options]="chartOptions" style="width:300px !important;">

                    </highcharts-chart>
                </mat-card-content>
            </mat-card>

        </div>
    </div>
    <br>

</div>